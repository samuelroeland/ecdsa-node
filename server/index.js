const express = require("express");
const app = express();
const cors = require("cors");
const port = 3042;

app.use(cors());
app.use(express.json());

const balances = {
  "040395162f2de52ee86e7cd27ea18b750b869fc7446e3b35cf01773b2507a1e99f4a476a3bf07c139ec0819126689927ca1c774148eedc94c17e932dd9969ff8a1": 100,
  "0468cf793ec6e37297c25efb6e9453b51c26aa87342b950ef41ac82dea4cb4c8717d7fbb3d6fc3f68cd70fa333380217959ab98c3989d9adda753b4173e850cc21": 50,
  "04bf99eadf5f51c5bc4bf05b883c905fd76ca7143236b87adbec631cdb239e2f0bbab348f387109ce5a1e56ab52a17f0be416d2069df31f91379164cafd50ee188": 75,
};

// use the following signatures to test
// 34382c36392c322c33332c302c3136332c3133322c32392c3233312c35362c36312c3133382c3231372c362c3234312c342c31332c33392c3131312c31352c3232342c3230362c31332c35332c342c3131372c3135322c3231362c37302c362c3133322c35372c3230322c3230332c31392c3231392c3234372c322c33322c3130332c3234332c3137322c3132362c3138362c38352c3233382c3133322c38352c392c3136342c3138302c3231352c36342c35302c34302c39382c3132312c3131302c32312c3234322c38332c362c3232352c3136392c3235352c3139392c3234372c3233302c302c3235302c323235
// 34382c36392c322c33332c302c3231392c3137362c3230352c3232342c38352c3130332c3139312c3134352c39352c35382c3234322c37302c3130372c3139302c3131352c39362c3134312c3138332c39302c3139382c31322c3234352c3132342c3232392c3232372c312c38382c37362c3135332c3137342c31372c38302c322c33322c33352c3139342c3132392c3231312c37382c3133302c3133322c34302c3130322c3130352c32342c3231352c3136342c39352c3139312c35302c32362c3135342c3137312c37362c3139322c34312c3230352c3130322c3233322c332c3137312c3233392c34372c34362c3231352c3132
// 34382c36392c322c33332c302c3234382c3233322c3230322c34382c3133332c34322c3134382c3139322c3134342c3132362c352c35352c33382c3131312c3136372c3138362c35352c31362c3231342c3233392c33372c3230382c3233392c37362c31342c3136362c3133312c3137382c36302c3137322c3139332c35382c322c33322c39332c3133322c342c31322c38332c38372c3139322c32372c3130312c33352c3131362c32342c3134312c3134362c3131302c3134352c3139372c3138302c3130352c3134352c3133362c31372c35362c39312c3131382c3233362c3135342c3138382c3136332c36302c3138352c323039

app.get("/balance/:address", (req, res) => {
  const { address } = req.params;
  const balance = balances[address] || 0;
  res.send({ balance });
});

app.post("/send", (req, res) => {
  const { sender, recipient, amount } = req.body;

  setInitialBalance(sender);
  setInitialBalance(recipient);

  if (balances[sender] < amount) {
    res.status(400).send({ message: "Not enough funds!" });
  } else {
    balances[sender] -= amount;
    balances[recipient] += amount;
    res.send({ balance: balances[sender] });
  }
});

app.listen(port, () => {
  console.log(`Listening on port ${port}!`);
});

function setInitialBalance(address) {
  if (!balances[address]) {
    balances[address] = 0;
  }
}
